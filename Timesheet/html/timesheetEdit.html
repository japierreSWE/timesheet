<!DOCTYPE html>
<html>

<head>
<title>Timesheet Edit</title>

<style>
	p {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>
var client_url = "https://x1me907yx3.execute-api.us-east-2.amazonaws.com/Alpha/client";
var clients = null;
var employee = JSON.parse(sessionStorage.getItem("employee"));

function preparePage() {
	var xhr = new XMLHttpRequest();
	xhr.open("GET", client_url, true);
	var json = JSON.stringify(""); //don't need anything
	xhr.send(json);
	
	xhr.onloadend = function() {
		console.log(xhr.responseText);
		if(xhr.readyState == XMLHttpRequest.DONE) {
			processResponse(xhr.responseText);
		} else {
			processResponse(null);
		}
		
	};
	
}

function processResponse(text) {
	var resp = JSON.parse(text);
	
	if(resp.httpCode == 400) {
		alert("There was an internal error. Please try logging in again.");
	}
	
	clients = resp.clients;
	
	var first = document.createElement("option");
	first.appendChild(document.createTextNode("--Select a client--"));
	document.getElementById("clientDropdown").appendChild(first);
	
	for(i = 0; i<clients.length; i++) {
		//add all clients' names from the response
		var option = document.createElement("option");
		option.appendChild(document.createTextNode(clients[i].name));
		document.getElementById("clientDropdown").appendChild(option);
		
	}
	
	document.getElementById("name").textContent = employee.name;
	document.getElementById("address").textContent = employee.address;
	
}

function showData() {
	
	//find a client that has the same name as the one chosen
	//in the dropdown, then put the manager and position in the
	//appropiate elements
	var current = document.getElementById("clientDropdown").value;
	var client = search(current);
	
	if(client != null) {
		document.getElementById("manager").textContent = client.manager;
		document.getElementById("position").textContent = client.position;
	} else {
		document.getElementById("manager").textContent = "";
		document.getElementById("position").textContent = "";
	}
	
	
}

//searches clients for the name and returns the client or null if not found
function search(str) {
	
	for(i = 0; i<clients.length; i++) {
		if(clients[i].name == str) {
			return clients[i];
		}
	}
	return null;
}

$(document).ready(preparePage); //use jquery to prepare the dropdown when the page has loaded

</script>
</head>

<body>
Work Title: <input type="text" id="workTitle"><br>
Completed for client: <select id="clientDropdown" onchange="showData()">
</select><br>
Name: <p id="name"></p><br>
Address: <p id="address"></p><br>
<p id="manager"></p>
<p id="position"></p>
</body>

</html>